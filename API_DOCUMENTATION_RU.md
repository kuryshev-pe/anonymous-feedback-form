# Документация по API для бэкенда анонимной формы обратной связи

Этот документ предоставляет подробную информацию об API-конечных точках, доступных в бэкенд-приложении анонимной формы обратной связи.

## Обзор

Бэкенд предоставляет RESTful API-конечные точки для управления анонимными отзывами. Система позволяет пользователям отправлять отзывы через интерфейс фронтенда, которые затем сохраняются в базе данных.

## Базовый URL

Все конечные точки имеют префикс `/api/`:
```
http://<ваш-домен>/api/
```

## Конечные точки

### 1. Получить токен CSRF

**Конечная точка:** `GET /api/message`

**Описание:** Эта конечная точка получает токен CSRF, необходимый для безопасных POST-запросов к конечной точке отправки отзывов.

**Запрос:**
- Метод: `GET`
- Заголовки: Не требуются
- Параметры: Нет

**Ответ:**
```json
{
  "CSRFToken": "csrf_token_value"
}
```

**Пример запроса:**
```bash
curl http://localhost:8000/api/message
```

**Пример ответа:**
```json
{
  "CSRFToken": "abc123def456ghi789"
}
```

### 2. Сохранить отзыв

**Конечная точка:** `POST /api/feedback`

**Описание:** Эта конечная точка принимает отправки отзывов от пользователей. Запрос должен включать действительный токен CSRF в заголовках.

**Запрос:**
- Метод: `POST`
- Заголовки:
  - `Content-Type: application/json`
  - `X-CSRFToken: <csrf_token_value>` (обязательно)
- Тело (JSON):
  ```json
  {
    "department": "string",
    "category": "string",
    "email": "string (необязательно)",
    "message": "string"
  }
  ```

**Параметры:**
| Поле | Тип | Обязательно | Описание |
|------|-----|-------------|----------|
| department | string | Нет | Департамент отправителя |
| category | string | Да | Категория отзыва |
| email | string | Нет | Адрес электронной почты (необязательно) |
| message | string | Да | Содержание отзыва |

**Ответ:**
```json
{
  "status": "ok"
}
```

**Пример запроса:**
```bash
curl -X POST http://localhost:8000/api/feedback \
  -H "Content-Type: application/json" \
  -H "X-CSRFToken: abc123def456ghi789" \
  -d '{
    "department": "IT",
    "category": "Suggestion",
    "email": "user@example.com",
    "message": "This is a sample feedback message."
  }'
```

**Пример ответа:**
```json
{
  "status": "ok"
}
```

### 3. Конечная точка ошибки (для тестирования)

**Конечная точка:** `GET /api/error`

**Описание:** Эта конечная точка намеренно вызывает ошибку для целей тестирования.

**Запрос:**
- Метод: `GET`
- Заголовки: Не требуются
- Параметры: Нет

**Ответ:**
Эта конечная точка вернет серверную ошибку (500) из-за намеренного деления на ноль.

## Модель данных

Данные отзыва хранятся в модели `FeedbackInfo` со следующими полями:

| Поле | Тип | Обязательно | Описание |
|------|-----|-------------|----------|
| department | CharField (max_length=16) | Нет | Департамент отправителя |
| email | EmailField | Нет | Адрес электронной почты отправителя |
| category | CharField (max_length=16) | Да | Категория отзыва |
| message | TextField | Да | Содержание отзыва |
| submission_date | DateTimeField | Нет | Дата и время, когда отзыв был отправлен |

## Обработка ошибок

API следует стандартным HTTP-кодам состояния:

- `200 OK`: Успешный запрос
- `400 Bad Request`: Неверный формат запроса или отсутствующие обязательные поля
- `500 Internal Server Error`: Серверные ошибки (например, проблемы с базой данных, намеренные ошибки для тестирования)

### Примеры ответов об ошибках

**Отсутствуют обязательные поля:**
```json
{
  "error": "Missing required fields",
  "status": 400
}
```

## Соображения безопасности

1. **Защита от CSRF**: Все POST-запросы требуют действительного токена CSRF для предотвращения атак межсайтовой подделки запросов.
2. **Валидация данных**: Бэкенд проверяет входные данные перед обработкой.
3. **Анонимность**: Идентификация пользователей не сохраняется вместе с отзывами.

## Пример использования

Вот полный пример использования API:

1. Сначала получите токен CSRF:
```bash
curl http://localhost:8000/api/message
```

2. Затем отправьте отзыв, используя полученный токен CSRF:
```bash
curl -X POST http://localhost:8000/api/feedback \
  -H "Content-Type: application/json" \
  -H "X-CSRFToken: <obtained_token>" \
  -d '{
    "department": "HR",
    "category": "Complaint",
    "message": "I have a complaint about the office environment."
  }'
```

## История версий

- **v1.0**: Первоначальный выпуск с базовой функциональностью отправки отзывов
- **v1.1**: Добавлена защита CSRF для всех POST-запросов